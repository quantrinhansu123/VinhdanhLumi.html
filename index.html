<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giao di·ªán T·ªïng - LUMI</title>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #display-frame {
            width: 100%;
            flex: 1;
            border: none;
            display: block;
        }

        /* Thanh ƒëi·ªÅu h∆∞·ªõng */
        .navigation-bar {
            background: linear-gradient(90deg, #66cc44 0%, #4a9928 25%, #2d7016 50%, #1a5c0e 75%, #0d3d07 100%);
            padding: 8px 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 -2px 10px rgba(13, 61, 7, 0.5), 0 -4px 20px rgba(102, 204, 68, 0.3);
            z-index: 1000;
        }

        .nav-btn {
            padding: 6px 16px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s ease;
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border-color: white;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
        }

        /* B·ªô l·ªçc */
        .filter-bar {
            background: linear-gradient(90deg, #66cc44 0%, #4a9928 25%, #2d7016 50%, #1a5c0e 75%, #0d3d07 100%);
            padding: 8px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(13, 61, 7, 0.5), 0 4px 20px rgba(102, 204, 68, 0.3);
            z-index: 1000;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 6px 15px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            outline: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .filter-select option {
            background: #667eea;
            color: white;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
    </style>
</head>

<body>
    <div class="filter-bar" id="filter-bar"></div>
    <iframe id="display-frame" src="./Th·∫ª c·∫£nh b√°o.html"></iframe>

    <div class="navigation-bar" id="navigation-bar"></div>

    <script>
        // Danh s√°ch c√°c tab theo th·ª© t·ª±
        const tabs = [
            {
                name: 'C·∫£nh B√°o',
                file: './Th·∫ª c·∫£nh b√°o.html',
                duration: 600000 // 10 ph√∫t = 600 gi√¢y = 600000ms
            },
            {
                name: 'BXH top 3',
                file: './BXH top 3.html',
                duration: 600000 // 10 ph√∫t = 600 gi√¢y = 600000ms
            },
            {
                name: 'BXH Top 3 th√°ng',
                file: './BXH top 3 th√°ng.html',
                duration: 600000 // 10 ph√∫t = 600 gi√¢y = 600000ms
            },
            {
                name: 'Vinh danh top 3',
                file: './Vinh danh top 3.html?mode=slideshow',
                duration: null // T·ª± ƒë·ªông - s·∫Ω t√≠nh to√°n d·ª±a tr√™n s·ªë ng∆∞·ªùi
            },
            {
                name: 'BXH to√†n Team',
                file: './danh s√°ch to√†n team.html',
                duration: 600000 // 10 ph√∫t = 600 gi√¢y = 600000ms
            }
        ];

        let currentTabIndex = 0;
        let tabTimer = null;
        let soundPlayer = null; // YouTube player ƒë·ªÉ ph√°t √¢m thanh
        let soundPlayCount = 0; // ƒê·∫øm s·ªë l·∫ßn ƒë√£ ph√°t
        let soundPlayTimer = null; // Timer ƒë·ªÉ ph√°t tu·∫ßn t·ª±

        // H√†m callback khi YouTube API s·∫µn s√†ng
        function onYouTubeIframeAPIReady() {
            console.log('[SOUND] YouTube API ƒë√£ s·∫µn s√†ng');
            initSoundPlayer();
        }

        // Kh·ªüi t·∫°o sound player
        function initSoundPlayer() {
            if (soundPlayer) return; // ƒê√£ kh·ªüi t·∫°o r·ªìi

            const playerId = 'tab-sound-player';
            let container = document.getElementById(playerId);
            if (!container) {
                container = document.createElement('div');
                container.id = playerId;
                container.style.display = 'none';
                document.body.appendChild(container);
            }

            try {
                soundPlayer = new YT.Player(playerId, {
                    height: '1',
                    width: '1',
                    videoId: 'EuLJv2qONRY',
                    playerVars: {
                        'autoplay': 0,
                        'loop': 0,
                        'controls': 0,
                        'showinfo': 0,
                        'rel': 0,
                        'modestbranding': 1,
                        'playsinline': 1
                    },
                    events: {
                        'onReady': function (event) {
                            event.target.setVolume(100);
                            console.log('[SOUND] Player ƒë√£ s·∫µn s√†ng');
                        },
                        'onStateChange': function (event) {
                            // Khi video k·∫øt th√∫c, ph√°t l·∫ßn ti·∫øp theo n·∫øu c√≤n
                            if (event.data === YT.PlayerState.ENDED) {
                                soundPlayCount++;
                                if (soundPlayCount < 4) {
                                    // Ph√°t l·∫ßn ti·∫øp theo sau 200ms
                                    setTimeout(() => {
                                        try {
                                            event.target.playVideo();
                                        } catch (e) {
                                            console.error('[SOUND] L·ªói ph√°t l·∫ßn ti·∫øp theo:', e);
                                        }
                                    }, 200);
                                } else {
                                    // ƒê√£ ph√°t ƒë·ªß 4 l·∫ßn
                                    soundPlayCount = 0;
                                    console.log('[SOUND] ƒê√£ ph√°t ƒë·ªß 4 l·∫ßn');
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error('[SOUND] L·ªói kh·ªüi t·∫°o player:', e);
            }
        }

        // H√†m ph√°t √¢m thanh 4 l·∫ßn khi chuy·ªÉn tab
        function playTabSwitchSound() {
            // ƒê·∫£m b·∫£o player ƒë√£ s·∫µn s√†ng
            if (!soundPlayer) {
                if (typeof YT !== 'undefined' && YT.Player) {
                    initSoundPlayer();
                    // ƒê·ª£i player kh·ªüi t·∫°o xong
                    setTimeout(() => {
                        if (soundPlayer) {
                            startPlayingSound();
                        }
                    }, 500);
                    return;
                } else {
                    console.warn('[SOUND] YouTube API ch∆∞a s·∫µn s√†ng');
                    return;
                }
            }

            startPlayingSound();
        }

        // H√†m b·∫Øt ƒë·∫ßu ph√°t √¢m thanh
        function startPlayingSound() {
            if (!soundPlayer) return;

            console.log('[SOUND] B·∫Øt ƒë·∫ßu ph√°t √¢m thanh chuy·ªÉn tab 4 l·∫ßn');

            // Reset counter v√† d·ª´ng video hi·ªán t·∫°i n·∫øu ƒëang ph√°t
            try {
                soundPlayCount = 0;
                // Ki·ªÉm tra xem player c√≥ s·∫µn ph∆∞∆°ng th·ª©c stopVideo kh√¥ng
                if (soundPlayer.stopVideo && typeof soundPlayer.stopVideo === 'function') {
                    soundPlayer.stopVideo();
                }
                // ƒê·ª£i m·ªôt ch√∫t r·ªìi b·∫Øt ƒë·∫ßu ph√°t
                setTimeout(() => {
                    if (soundPlayer.seekTo && typeof soundPlayer.seekTo === 'function') {
                        soundPlayer.seekTo(0, true); // Quay v·ªÅ ƒë·∫ßu video
                    }
                    if (soundPlayer.playVideo && typeof soundPlayer.playVideo === 'function') {
                        soundPlayer.playVideo(); // B·∫Øt ƒë·∫ßu ph√°t l·∫ßn ƒë·∫ßu
                    }
                }, 100);
            } catch (e) {
                console.error('[SOUND] L·ªói ph√°t √¢m thanh:', e);
            }
        }

        // T·∫°o thanh ƒëi·ªÅu h∆∞·ªõng
        function createNavigationBar() {
            const navBar = document.getElementById('navigation-bar');
            navBar.innerHTML = '';

            tabs.forEach((tab, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.textContent = tab.name;
                btn.onclick = () => loadTab(index);
                navBar.appendChild(btn);
            });

            updateNavigationButtons();
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c n√∫t
        function updateNavigationButtons() {
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach((btn, index) => {
                if (index === currentTabIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function loadTab(index) {
            if (index < 0 || index >= tabs.length) {
                index = 0; // Quay v·ªÅ tab ƒë·∫ßu ti√™n
            }
            currentTabIndex = index;

            const tab = tabs[currentTabIndex];
            const frame = document.getElementById('display-frame');

            console.log(`[TAB SWITCH] ƒêang chuy·ªÉn sang: ${tab.name}`);

            // Ph√°t √¢m thanh chuy·ªÉn tab 4 l·∫ßn
            if (typeof YT !== 'undefined' && YT.Player) {
                playTabSwitchSound();
            } else {
                // N·∫øu API ch∆∞a s·∫µn s√†ng, ƒë·ª£i m·ªôt ch√∫t r·ªìi th·ª≠ l·∫°i
                setTimeout(() => {
                    if (typeof YT !== 'undefined' && YT.Player) {
                        playTabSwitchSound();
                    }
                }, 500);
            }

            frame.src = tab.file;

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
            updateNavigationButtons();

            // X√≥a timer c≈© n·∫øu c√≥
            if (tabTimer) {
                clearTimeout(tabTimer);
            }

            // T√≠nh th·ªùi gian cho tab hi·ªán t·∫°i
            let duration = tab.duration;

            // N·∫øu l√† "Vinh danh top 3", t√≠nh to√°n th·ªùi gian d·ª±a tr√™n s·ªë ng∆∞·ªùi
            if (tab.name === 'Vinh danh top 3' && duration === null) {
                try {
                    const honorsDataStr = localStorage.getItem('vinhDanhTop3');
                    if (honorsDataStr) {
                        const honorsData = JSON.parse(honorsDataStr);
                        const numPeople = honorsData.length || 6; // M·∫∑c ƒë·ªãnh 6 ng∆∞·ªùi (3 Sale + 3 MKT)
                        duration = numPeople * 30000; // M·ªói ng∆∞·ªùi 30 gi√¢y
                        console.log(`[VINH DANH] C√≥ ${numPeople} ng∆∞·ªùi, th·ªùi gian: ${duration / 1000} gi√¢y`);
                    } else {
                        duration = 180000; // M·∫∑c ƒë·ªãnh 3 ph√∫t (6 ng∆∞·ªùi * 30s) n·∫øu kh√¥ng c√≥ data
                    }
                } catch (e) {
                    console.error('L·ªói ƒë·ªçc d·ªØ li·ªáu vinh danh:', e);
                    duration = 180000; // M·∫∑c ƒë·ªãnh 3 ph√∫t
                }
            }

            // ƒê·∫∑t timer ƒë·ªÉ chuy·ªÉn sang tab ti·∫øp theo
            if (duration) {
                tabTimer = setTimeout(() => {
                    loadTab(currentTabIndex + 1);
                }, duration);
                console.log(`[TIMER] Tab "${tab.name}" s·∫Ω chuy·ªÉn sau ${duration / 1000} gi√¢y (${duration / 60000} ph√∫t)`);
            }
        }

        // --- B·ªò L·ªåC ---
        function createFilterBar() {
            const filterBar = document.getElementById('filter-bar');

            // T·∫°o HTML cho b·ªô l·ªçc
            filterBar.innerHTML = `
                <div class="filter-group">
                    <label style="color: white; font-weight: 600; margin-right: 5px; font-size: 11px;">Lo·∫°i:</label>
                    <select class="filter-select" id="period-type">
                        <option value="week">Theo Tu·∫ßn</option>
                        <option value="month">Theo Th√°ng</option>
                    </select>
                </div>
                
                <div class="filter-group" id="week-filter-container">
                    <label style="color: white; font-weight: 600; margin-right: 5px; font-size: 11px;">Tu·∫ßn:</label>
                    <select class="filter-select" id="period-value">
                        <option value="w1">Tu·∫ßn 1 (28/12 - 3/1)</option>
                        <option value="w2">Tu·∫ßn 2 (4/1 - 10/1)</option>
                        <option value="w3">Tu·∫ßn 3 (11/1 - 17/1)</option>
                        <option value="w4">Tu·∫ßn 4 (18/1 - 24/1)</option>
                        <option value="w5">Tu·∫ßn 5 (25/1 - 31/1)</option>
                    </select>
                </div>
                
                <div class="filter-group" id="month-filter-container" style="display: none;">
                    <label style="color: white; font-weight: 600; margin-right: 5px; font-size: 11px;">Th√°ng:</label>
                    <select class="filter-select" id="filter-month">
                        <option value="1">Th√°ng 1</option>
                        <option value="2">Th√°ng 2</option>
                        <option value="3">Th√°ng 3</option>
                        <option value="4">Th√°ng 4</option>
                        <option value="5">Th√°ng 5</option>
                        <option value="6">Th√°ng 6</option>
                        <option value="7">Th√°ng 7</option>
                        <option value="8">Th√°ng 8</option>
                        <option value="9">Th√°ng 9</option>
                        <option value="10">Th√°ng 10</option>
                        <option value="11">Th√°ng 11</option>
                        <option value="12">Th√°ng 12</option>
                    </select>
                    <select class="filter-select" id="filter-year">
                        <!-- S·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS -->
                    </select>
                </div>
            `;

            // ƒêi·ªÅn nƒÉm
            populateYears();

            // C·∫≠p nh·∫≠t c√°c option tu·∫ßn v·ªõi th·ªùi gian th·ª±c t·∫ø
            populateWeekOptions();

            // Load filter settings t·ª´ localStorage n·∫øu c√≥
            loadFilterSettings();

            // Th√™m event listeners
            document.getElementById('period-type').addEventListener('change', function () {
                toggleFilterUI();
                saveFilterSettings();
                notifyFilterChange();
            });

            document.getElementById('period-value').addEventListener('change', function () {
                saveFilterSettings();
                notifyFilterChange();
            });

            document.getElementById('filter-month').addEventListener('change', function () {
                adjustYearForMonth();
                saveFilterSettings();
                notifyFilterChange();
            });

            document.getElementById('filter-year').addEventListener('change', function () {
                saveFilterSettings();
                notifyFilterChange();
            });
        }

        function populateYears() {
            const sel = document.getElementById('filter-year');
            if (!sel) return;
            const cy = new Date().getFullYear();
            sel.innerHTML = '';
            for (let y = cy - 1; y <= cy + 1; y++) {
                let opt = document.createElement('option');
                opt.value = y;
                opt.text = "NƒÉm " + y;
                if (y === cy) opt.selected = true;
                sel.appendChild(opt);
            }
        }

        // H√†m helper: T√≠nh tu·∫ßn t·ª´ m·ªôt ng√†y (b·∫Øt ƒë·∫ßu th·ª© 2, k·∫øt th√∫c ch·ªß nh·∫≠t)
        function getWeekRange(date) {
            const d = new Date(date);
            const day = d.getDay(); // 0 = Ch·ªß nh·∫≠t, 1 = Th·ª© 2, ..., 6 = Th·ª© 7
            const diff = day === 0 ? -6 : 1 - day; // T√≠nh s·ªë ng√†y c·∫ßn tr·ª´ ƒë·ªÉ v·ªÅ th·ª© 2
            const monday = new Date(d);
            monday.setDate(d.getDate() + diff);
            monday.setHours(0, 0, 0, 0);

            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            sunday.setHours(23, 59, 59, 999);

            return { start: monday, end: sunday };
        }

        // C·∫≠p nh·∫≠t c√°c option tu·∫ßn v·ªõi th·ªùi gian th·ª±c t·∫ø
        function populateWeekOptions() {
            const weekSelect = document.getElementById('period-value');
            if (!weekSelect) return;

            const weekRanges = [
                { id: 'w1', date: new Date(2025, 11, 29) }, // Th·ª© 2
                { id: 'w2', date: new Date(2026, 0, 5) }, // Th·ª© 2
                { id: 'w3', date: new Date(2026, 0, 12) }, // Th·ª© 2
                { id: 'w4', date: new Date(2026, 0, 19) }, // Th·ª© 2
                { id: 'w5', date: new Date(2026, 0, 26) } // Th·ª© 2
            ];

            weekSelect.innerHTML = ''; // X√≥a c√°c option c≈©

            weekRanges.forEach(week => {
                const weekRange = getWeekRange(week.date);
                const startDay = weekRange.start.getDate();
                const startMonth = weekRange.start.getMonth() + 1;
                const endDay = weekRange.end.getDate();
                const endMonth = weekRange.end.getMonth() + 1;

                const opt = document.createElement('option');
                opt.value = week.id;
                opt.textContent = `Tu·∫ßn ${week.id.replace('w', '')} (${startDay}/${startMonth} - ${endDay}/${endMonth})`;
                weekSelect.appendChild(opt);
            });
        }

        function getCurrentWeek() {
            const now = new Date();
            now.setHours(0, 0, 0, 0);

            // T√≠nh tu·∫ßn hi·ªán t·∫°i (b·∫Øt ƒë·∫ßu t·ª´ th·ª© 2)
            const day = now.getDay();
            const diff = day === 0 ? -6 : 1 - day;
            const monday = new Date(now);
            monday.setDate(now.getDate() + diff);
            monday.setHours(0, 0, 0, 0);

            // So s√°nh v·ªõi c√°c tu·∫ßn ƒë√£ ƒë·ªãnh nghƒ©a
            const weekRanges = [
                { id: 'w1', date: new Date(2025, 11, 29) },
                { id: 'w2', date: new Date(2026, 0, 5) },
                { id: 'w3', date: new Date(2026, 0, 12) },
                { id: 'w4', date: new Date(2026, 0, 19) },
                { id: 'w5', date: new Date(2026, 0, 26) }
            ];

            for (let week of weekRanges) {
                const weekDate = new Date(week.date);
                weekDate.setHours(0, 0, 0, 0);
                const weekDay = weekDate.getDay();
                const weekDiff = weekDay === 0 ? -6 : 1 - weekDay;
                const weekMonday = new Date(weekDate);
                weekMonday.setDate(weekDate.getDate() + weekDiff);

                if (monday.getTime() === weekMonday.getTime()) {
                    return week.id;
                }
            }

            return 'w1'; // M·∫∑c ƒë·ªãnh
        }

        function toggleFilterUI() {
            const type = document.getElementById('period-type').value;
            const weekContainer = document.getElementById('week-filter-container');
            const monthContainer = document.getElementById('month-filter-container');

            if (weekContainer) {
                weekContainer.style.display = type === 'week' ? 'flex' : 'none';
            }
            if (monthContainer) {
                monthContainer.style.display = type === 'month' ? 'flex' : 'none';
            }

            if (type === 'month') {
                adjustYearForMonth();
            }
        }

        function adjustYearForMonth() {
            const selectedMonth = parseInt(document.getElementById('filter-month').value);
            const selectedYear = parseInt(document.getElementById('filter-year').value);
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1;
            const currentYear = currentDate.getFullYear();

            if (selectedMonth > currentMonth && selectedYear === currentYear) {
                document.getElementById('filter-year').value = currentYear - 1;
            }
        }

        function saveFilterSettings() {
            const type = document.getElementById('period-type').value;
            const weekValue = document.getElementById('period-value').value;
            const m = parseInt(document.getElementById('filter-month').value);
            const y = parseInt(document.getElementById('filter-year').value);

            const settings = {
                periodType: type,
                periodValue: weekValue,
                month: m,
                year: y
            };

            localStorage.setItem('filterSettings', JSON.stringify(settings));
            console.log('[FILTER] ƒê√£ l∆∞u filter settings:', settings);
        }

        function loadFilterSettings() {
            try {
                const settingsStr = localStorage.getItem('filterSettings');
                if (settingsStr) {
                    const settings = JSON.parse(settingsStr);

                    if (document.getElementById('period-type')) {
                        document.getElementById('period-type').value = settings.periodType || 'week';
                    }
                    if (document.getElementById('period-value')) {
                        document.getElementById('period-value').value = settings.periodValue || getCurrentWeek();
                    }
                    if (document.getElementById('filter-month')) {
                        document.getElementById('filter-month').value = settings.month || new Date().getMonth() + 1;
                    }
                    if (document.getElementById('filter-year')) {
                        document.getElementById('filter-year').value = settings.year || new Date().getFullYear();
                    }

                    toggleFilterUI();
                    console.log('[FILTER] ƒê√£ load filter settings:', settings);
                } else {
                    // L·∫ßn ƒë·∫ßu load - gi·ªØ gi√° tr·ªã m·∫∑c ƒë·ªãnh t·ª´ HTML (kh√¥ng t·ª± ƒë·ªông set v·ªÅ tu·∫ßn hi·ªán t·∫°i)
                    toggleFilterUI();
                    // L∆∞u gi√° tr·ªã hi·ªán t·∫°i v√†o localStorage ƒë·ªÉ gi·ªØ nguy√™n l·ª±a ch·ªçn
                    saveFilterSettings();
                    console.log('[FILTER] L·∫ßn ƒë·∫ßu load - gi·ªØ gi√° tr·ªã m·∫∑c ƒë·ªãnh');
                }
            } catch (e) {
                console.error('[FILTER] L·ªói load settings:', e);
            }
        }

        function notifyFilterChange() {
            // L∆∞u filter settings v√†o localStorage
            saveFilterSettings();
            // X√≥a flag ƒë·ªÉ ƒë·∫£m b·∫£o c√°c trang kh√°c bi·∫øt filter ƒë·∫øn t·ª´ index.html
            localStorage.removeItem('filterSource');
            console.log('[FILTER] üîÑ Filter ƒë√£ thay ƒë·ªïi, b·∫Øt ƒë·∫ßu c·∫≠p nh·∫≠t d·ªØ li·ªáu...');
            
            // G·ª≠i message ƒë·∫øn iframe hi·ªán t·∫°i ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu
            const frame = document.getElementById('display-frame');
            if (frame && frame.contentWindow) {
                try {
                    frame.contentWindow.postMessage({ type: 'filterChanged' }, '*');
                    console.log('[FILTER] ‚úÖ ƒê√£ g·ª≠i filterChanged message ƒë·∫øn iframe hi·ªán t·∫°i');
                } catch (e) {
                    console.error('[FILTER] ‚ùå L·ªói g·ª≠i message ƒë·∫øn iframe:', e);
                }
            }
            
            // LU√îN load "BXH top 3.html" trong background ƒë·ªÉ t√≠nh to√°n l·∫°i d·ªØ li·ªáu khi filter thay ƒë·ªïi
            // ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o "danh s√°ch to√†n team.html" lu√¥n c√≥ d·ªØ li·ªáu m·ªõi nh·∫•t
            const bxhTop3TabIndex = tabs.findIndex(tab => tab.name === 'BXH top 3');
            const currentTab = tabs[currentTabIndex];
            const isBXHTop3Tab = currentTab && (currentTab.name === 'BXH top 3');
            
            // LU√îN load BXH top 3 trong background (k·ªÉ c·∫£ khi ƒëang ·ªü tab ƒë√≥) ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√°n l·∫°i
            if (bxhTop3TabIndex !== -1) {
                console.log('[FILTER] üîÑ Load BXH top 3 trong background ƒë·ªÉ t√≠nh to√°n l·∫°i d·ªØ li·ªáu...');
                // T·∫°o iframe ·∫©n ƒë·ªÉ load BXH top 3
                const hiddenFrame = document.createElement('iframe');
                hiddenFrame.style.position = 'absolute';
                hiddenFrame.style.left = '-9999px';
                hiddenFrame.style.width = '1px';
                hiddenFrame.style.height = '1px';
                hiddenFrame.src = tabs[bxhTop3TabIndex].file;
                hiddenFrame.onload = function() {
                    console.log('[FILTER] ‚úÖ BXH top 3 ƒë√£ load, g·ª≠i message ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu...');
                    setTimeout(() => {
                        try {
                            if (hiddenFrame.contentWindow) {
                                hiddenFrame.contentWindow.postMessage({ type: 'filterChanged' }, '*');
                                console.log('[FILTER] ‚úÖ ƒê√£ g·ª≠i filterChanged message ƒë·∫øn BXH top 3');
                            }
                            // X√≥a iframe sau 10 gi√¢y (tƒÉng th·ªùi gian ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√°n xong)
                            setTimeout(() => {
                                if (hiddenFrame.parentNode) {
                                    hiddenFrame.parentNode.removeChild(hiddenFrame);
                                    console.log('[FILTER] üóëÔ∏è ƒê√£ x√≥a hidden iframe');
                                }
                            }, 10000);
                        } catch (e) {
                            console.error('[FILTER] ‚ùå L·ªói g·ª≠i message ƒë·∫øn BXH top 3:', e);
                        }
                    }, 2000); // TƒÉng th·ªùi gian ƒë·ª£i l√™n 2 gi√¢y ƒë·ªÉ ƒë·∫£m b·∫£o trang load xong
                };
                document.body.appendChild(hiddenFrame);
            }
        }

        // Kh·ªüi ƒë·ªông
        createFilterBar();
        createNavigationBar();

        // T·ª± ƒë·ªông load "BXH top 3.html" m·ªôt l·∫ßn khi kh·ªüi ƒë·ªông ƒë·ªÉ t√≠nh to√°n d·ªØ li·ªáu ban ƒë·∫ßu
        function initializeBXHTop3() {
            const bxhTop3TabIndex = tabs.findIndex(tab => tab.name === 'BXH top 3');
            if (bxhTop3TabIndex !== -1) {
                console.log('[INIT] ƒêang load BXH top 3 ƒë·ªÉ t√≠nh to√°n d·ªØ li·ªáu ban ƒë·∫ßu...');
                const hiddenFrame = document.createElement('iframe');
                hiddenFrame.style.position = 'absolute';
                hiddenFrame.style.left = '-9999px';
                hiddenFrame.style.width = '1px';
                hiddenFrame.style.height = '1px';
                hiddenFrame.src = tabs[bxhTop3TabIndex].file;
                hiddenFrame.onload = function() {
                    console.log('[INIT] BXH top 3 ƒë√£ load xong, d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c t√≠nh to√°n v√† l∆∞u v√†o localStorage');
                    // X√≥a iframe sau 5 gi√¢y
                    setTimeout(() => {
                        if (hiddenFrame.parentNode) {
                            hiddenFrame.parentNode.removeChild(hiddenFrame);
                        }
                    }, 5000);
                };
                document.body.appendChild(hiddenFrame);
            }
        }

        // G·ªçi sau khi DOM ƒë√£ load xong
        setTimeout(() => {
            initializeBXHTop3();
        }, 1000);

        // Kh·ªüi t·∫°o sound player n·∫øu YouTube API ƒë√£ s·∫µn s√†ng
        if (typeof YT !== 'undefined' && YT.Player) {
            initSoundPlayer();
        } else {
            // ƒê·ª£i YouTube API load
            let checkAPI = setInterval(() => {
                if (typeof YT !== 'undefined' && YT.Player) {
                    initSoundPlayer();
                    clearInterval(checkAPI);
                }
            }, 100);
            // Timeout sau 5 gi√¢y
            setTimeout(() => clearInterval(checkAPI), 5000);
        }

        loadTab(0);

        // X·ª≠ l√Ω l·ªói iframe
        document.getElementById('display-frame').addEventListener('error', function (e) {
            console.error('L·ªói load iframe:', e);
            // Th·ª≠ chuy·ªÉn sang tab ti·∫øp theo n·∫øu c√≥ l·ªói
            setTimeout(() => {
                loadTab(currentTabIndex + 1);
            }, 5000);
        });
    </script>
</body>

</html>