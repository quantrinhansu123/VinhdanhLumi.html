<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giao diện Tổng - LUMI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #display-frame {
            width: 100%;
            flex: 1;
            border: none;
            display: block;
        }

        /* Thanh điều hướng */
        .navigation-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border-color: white;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body>
    <iframe id="display-frame" src="Thẻ cảnh báo.html"></iframe>
    
    <div class="navigation-bar" id="navigation-bar"></div>

    <script>
        // Danh sách các tab theo thứ tự
        const tabs = [
            {
                name: 'Thẻ cảnh báo',
                file: 'Thẻ cảnh báo.html',
                duration: 600000 // 10 phút = 600 giây = 600000ms
            },
            {
                name: 'BXH top 3',
                file: 'BXH top 3.html',
                duration: 600000 // 10 phút = 600 giây = 600000ms
            },
            {
                name: 'Vinh danh top 3',
                file: 'Vinh danh top 3.html?mode=slideshow',
                duration: null // Tự động - sẽ tính toán dựa trên số người
            },
            {
                name: 'danh sách toàn team',
                file: 'danh sách toàn team.html',
                duration: 600000 // 10 phút = 600 giây = 600000ms
            }
        ];

        let currentTabIndex = 0;
        let tabTimer = null;

        // Tạo thanh điều hướng
        function createNavigationBar() {
            const navBar = document.getElementById('navigation-bar');
            navBar.innerHTML = '';
            
            tabs.forEach((tab, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.textContent = tab.name;
                btn.onclick = () => loadTab(index);
                navBar.appendChild(btn);
            });
            
            updateNavigationButtons();
        }

        // Cập nhật trạng thái các nút
        function updateNavigationButtons() {
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach((btn, index) => {
                if (index === currentTabIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function loadTab(index) {
            if (index < 0 || index >= tabs.length) {
                index = 0; // Quay về tab đầu tiên
            }
            currentTabIndex = index;
            
            const tab = tabs[currentTabIndex];
            const frame = document.getElementById('display-frame');
            
            console.log(`[TAB SWITCH] Đang chuyển sang: ${tab.name}`);
            frame.src = tab.file;
            
            // Cập nhật trạng thái nút
            updateNavigationButtons();

            // Xóa timer cũ nếu có
            if (tabTimer) {
                clearTimeout(tabTimer);
            }

            // Tính thời gian cho tab hiện tại
            let duration = tab.duration;
            
            // Nếu là "Vinh danh top 3", tính toán thời gian dựa trên số người
            if (tab.name === 'Vinh danh top 3' && duration === null) {
                try {
                    const honorsDataStr = localStorage.getItem('vinhDanhTop3');
                    if (honorsDataStr) {
                        const honorsData = JSON.parse(honorsDataStr);
                        const numPeople = honorsData.length || 6; // Mặc định 6 người (3 Sale + 3 MKT)
                        duration = numPeople * 30000; // Mỗi người 30 giây
                        console.log(`[VINH DANH] Có ${numPeople} người, thời gian: ${duration/1000} giây`);
                    } else {
                        duration = 180000; // Mặc định 3 phút (6 người * 30s) nếu không có data
                    }
                } catch (e) {
                    console.error('Lỗi đọc dữ liệu vinh danh:', e);
                    duration = 180000; // Mặc định 3 phút
                }
            }

            // Đặt timer để chuyển sang tab tiếp theo
            if (duration) {
                tabTimer = setTimeout(() => {
                    loadTab(currentTabIndex + 1);
                }, duration);
                console.log(`[TIMER] Tab "${tab.name}" sẽ chuyển sau ${duration/1000} giây (${duration/60000} phút)`);
            }
        }

        // Khởi động
        createNavigationBar();
        loadTab(0);

        // Xử lý lỗi iframe
        document.getElementById('display-frame').addEventListener('error', function(e) {
            console.error('Lỗi load iframe:', e);
            // Thử chuyển sang tab tiếp theo nếu có lỗi
            setTimeout(() => {
                loadTab(currentTabIndex + 1);
            }, 5000);
        });
    </script>
</body>
</html>

